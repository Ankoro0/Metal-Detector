<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2c3e50">
    <title>Detektor Tracker</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>üß≠ GPS Metal Detector Tracker</h1>
            <div class="session-selector">
                <select id="sessionSelect" class="session-dropdown">
                </select>
                <button id="newSessionBtn" class="btn-small btn-new-session" title="Create New Session">‚ûï</button>
                <button id="deleteSessionBtn" class="btn-small btn-delete-session" title="Delete Current Session">üóëÔ∏è</button>
            </div>
            <div class="gps-status" id="gpsStatus">
                <span class="gps-indicator"></span>
                <span id="gpsText">GPS Neaktivan</span>
            </div>
        </header>

        <!-- Info Banner (prikazuje se samo prvi put) -->
        <div id="infoBanner" class="info-banner hidden">
            <div class="info-content">
                <strong>‚ÑπÔ∏è Va≈æno:</strong> Browser ƒáe tra≈æiti dozvolu za GPS. <strong>Odobri jednom</strong> i neƒáe te vi≈°e pitati.<br>
                <small>Ako otvara≈° preko file://, preporuƒçujem: <code>python -m http.server 8000</code></small>
            </div>
            <button id="closeInfoBtn" class="btn-close-info">‚úï</button>
        </div>

        <!-- Mapa (Canvas) -->
        <div class="map-container">
            <canvas id="mapCanvas"></canvas>
            <div class="map-info">
                <div id="trackingInfo" class="tracking-info hidden">
                    <span>üìç Preƒëeno: <strong id="distanceText">0m</strong></span>
                    <span>‚è±Ô∏è Vreme: <strong id="timeText">00:00</strong></span>
                </div>
                <div class="map-controls">
                    <button id="centerMapBtn" class="btn-map" title="Centriraj mapu">üéØ</button>
                    <button id="zoomInBtn" class="btn-map" title="Zoom In">+</button>
                    <button id="zoomOutBtn" class="btn-map" title="Zoom Out">‚àí</button>
                </div>
            </div>
        </div>

        <!-- Kontrole -->
        <div class="controls">
            <button id="startBtn" class="btn btn-primary">
                <span class="btn-icon">‚ñ∂</span>
                START
            </button>
            <button id="testModeBtn" class="btn btn-test" title="TEST MODE - simuliraj GPS za desktop">
                <span class="btn-icon">üß™</span>
                TEST MODE
            </button>
            <button id="checkpointBtn" class="btn btn-success hidden" disabled>
                <span class="btn-icon">üìç</span>
                CHECKPOINT
            </button>
            <button id="stopBtn" class="btn btn-danger hidden">
                <span class="btn-icon">‚èπ</span>
                STOP
            </button>
        </div>

        <!-- Lista Checkpointa -->
        <div class="checkpoints-section">
            <div class="section-header">
                <h2>Mete / Checkpointi</h2>
                <div class="export-controls">
                    <button id="copyAIBtn" class="btn-small btn-ai">ü§ñ Copy for AI</button>
                    <button id="exportBtn" class="btn-small btn-export">üì§ Export</button>
                    <button id="importBtn" class="btn-small btn-import">üì• Import</button>
                    <input type="file" id="importFile" accept=".json" style="display:none">
                </div>
            </div>
            <div id="checkpointsList" class="checkpoints-list">
                <p class="empty-state">Nema checkpointa. Klikni START i kreni sa detektorom.</p>
            </div>
        </div>
    </div>

    <!-- Modal za kreiranje checkpointa -->
    <div id="checkpointModal" class="modal hidden">
        <div class="modal-content">
            <h3>Nova Meta</h3>
            <input type="text" id="checkpointName" placeholder="Opis (npr: gvozdeni predmet, srebrnjak...)" maxlength="100">
            
            <label>Jaƒçina Signala</label>
            <select id="checkpointSignal">
                <option value="weak">Slab</option>
                <option value="medium" selected>Srednji</option>
                <option value="strong">Jak</option>
                <option value="very-strong">Veoma Jak</option>
            </select>

            <label>Dubina (linije na ekranu, 1-5)</label>
            <input type="number" id="checkpointDepth" placeholder="npr: 3 linije" min="1" max="5" step="1">

            <label>VDI broj (Target ID: -19 do 99)</label>
            <input type="text" id="checkpointIDRange" placeholder="npr: VDI 82, VDI -5" maxlength="50">

            <label>Napomena (optional)</label>
            <textarea id="checkpointNotes" placeholder="Dodatne napomene..." rows="2" maxlength="200"></textarea>

            <div class="modal-actions">
                <button id="saveCheckpointBtn" class="btn btn-success">Saƒçuvaj</button>
                <button id="cancelCheckpointBtn" class="btn btn-secondary">Otka≈æi</button>
            </div>
        </div>
    </div>

    <script src="db.js?v=2"></script>
    <script src="app.js?v=2"></script>
</body>
</html>
